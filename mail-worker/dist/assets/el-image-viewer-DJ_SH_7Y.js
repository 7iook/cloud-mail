import{aD as J,b as ye,d as Q,a0 as Ie,_ as Ce,a as se,bR as U,bS as xe,bT as Ne,bs as ze,c as Ee,bU as Te,A as y,bV as Le,ak as Oe,l as b,G as ee,J as Re,b7 as z,p as ae,o as w,q as d,a7 as l,T as Se,g as v,j as te,n as c,h as a,f as h,e as E,r as D,ag as $e,M as k,aS as Me,Q as P,aW as Ve,C as Ye,i as Ae,t as De,bW as Pe,bX as Xe,aj as Be,bY as Fe,bZ as He,af as We,bd as je,E as I,a1 as qe,w as Ke}from"./index-92mnh-J5.js";import{b as Ze,c as Ge}from"./vnode-DfneDD37.js";import{t as X}from"./throttle-BQKBmdXm.js";const Je=ye({urlList:{type:Q(Array),default:()=>Ie([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Qe={close:()=>!0,switch:C=>J(C),rotate:C=>J(C)},Ue=se({name:"ElImageViewer"}),ea=se({...Ue,props:Je,emits:Qe,setup(C,{expose:ne,emit:T}){var B;const r=C,x={CONTAIN:{name:"contain",icon:U(Ne)},ORIGINAL:{name:"original",icon:U(xe)}};let S,F="";const{t:oe}=ze(),s=Ee("image-viewer"),{nextZIndex:le}=Te(),$=y(),H=y([]),W=Le(),_=y(!0),u=y(r.initialIndex),L=Oe(x.CONTAIN),n=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),re=y((B=r.zIndex)!=null?B:le()),ie=b(()=>{const{urlList:e}=r;return e.length<=1}),j=b(()=>u.value===0),q=b(()=>u.value===r.urlList.length-1),ce=b(()=>r.urlList[u.value]),ue=b(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!r.infinite&&j.value)]),de=b(()=>[s.e("btn"),s.e("next"),s.is("disabled",!r.infinite&&q.value)]),fe=b(()=>{const{scale:e,deg:o,offsetX:t,offsetY:i,enableTransition:f}=n.value;let m=t/e,g=i/e;const N=o*Math.PI/180,Z=Math.cos(N),G=Math.sin(N);m=m*Z+g*G,g=g*Z-t/e*G;const A={transform:`scale(${e}) rotate(${o}deg) translate(${m}px, ${g}px)`,transition:f?"transform .3s":""};return L.value.name===x.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),me=b(()=>`${u.value+1} / ${r.urlList.length}`);function O(){pe(),S?.(),document.body.style.overflow=F,T("close")}function ve(){const e=X(t=>{switch(t.code){case I.esc:r.closeOnPressEscape&&O();break;case I.space:M();break;case I.left:V();break;case I.up:p("zoomIn");break;case I.right:Y();break;case I.down:p("zoomOut");break}}),o=X(t=>{const i=t.deltaY||t.deltaX;p(i<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});W.run(()=>{z(document,"keydown",e),z(document,"wheel",o)})}function pe(){W.stop()}function ge(){_.value=!1}function be(e){_.value=!1,e.target.alt=oe("el.image.error")}function ke(e){if(_.value||e.button!==0||!$.value)return;n.value.enableTransition=!1;const{offsetX:o,offsetY:t}=n.value,i=e.pageX,f=e.pageY,m=X(N=>{n.value={...n.value,offsetX:o+N.pageX-i,offsetY:t+N.pageY-f}}),g=z(document,"mousemove",m);z(document,"mouseup",()=>{g()}),e.preventDefault()}function K(){n.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function M(){if(_.value)return;const e=je(x),o=Object.values(x),t=L.value.name,f=(o.findIndex(m=>m.name===t)+1)%e.length;L.value=x[e[f]],K()}function R(e){const o=r.urlList.length;u.value=(e+o)%o}function V(){j.value&&!r.infinite||R(u.value-1)}function Y(){q.value&&!r.infinite||R(u.value+1)}function p(e,o={}){if(_.value)return;const{minScale:t,maxScale:i}=r,{zoomRate:f,rotateDeg:m,enableTransition:g}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...o};switch(e){case"zoomOut":n.value.scale>t&&(n.value.scale=Number.parseFloat((n.value.scale/f).toFixed(3)));break;case"zoomIn":n.value.scale<i&&(n.value.scale=Number.parseFloat((n.value.scale*f).toFixed(3)));break;case"clockwise":n.value.deg+=m,T("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=m,T("rotate",n.value.deg);break}n.value.enableTransition=g}function we(e){var o;((o=e.detail)==null?void 0:o.focusReason)==="pointer"&&e.preventDefault()}function he(){r.closeOnPressEscape&&O()}function _e(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ee(ce,()=>{qe(()=>{const e=H.value[0];e?.complete||(_.value=!0)})}),ee(u,e=>{K(),T("switch",e)}),Re(()=>{ve(),S=z("wheel",_e,{passive:!1}),F=document.body.style.overflow,document.body.style.overflow="hidden"}),ne({setActiveItem:R}),(e,o)=>(w(),ae(a(Ge),{to:"body",disabled:!e.teleported},{default:d(()=>[l(Se,{name:"viewer-fade",appear:""},{default:d(()=>[v("div",{ref_key:"wrapper",ref:$,tabindex:-1,class:c(a(s).e("wrapper")),style:te({zIndex:re.value})},[l(a(Ze),{loop:"",trapped:"","focus-trap-el":$.value,"focus-start-el":"container",onFocusoutPrevented:we,onReleaseRequested:he},{default:d(()=>[v("div",{class:c(a(s).e("mask")),onClick:$e(t=>e.hideOnClickModal&&O(),["self"])},null,10,["onClick"]),h(" CLOSE "),v("span",{class:c([a(s).e("btn"),a(s).e("close")]),onClick:O},[l(a(k),null,{default:d(()=>[l(a(Me))]),_:1})],2),h(" ARROW "),a(ie)?h("v-if",!0):(w(),E(P,{key:0},[v("span",{class:c(a(ue)),onClick:V},[l(a(k),null,{default:d(()=>[l(a(Ve))]),_:1})],2),v("span",{class:c(a(de)),onClick:Y},[l(a(k),null,{default:d(()=>[l(a(Ye))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(w(),E("div",{key:1,class:c([a(s).e("btn"),a(s).e("progress")])},[D(e.$slots,"progress",{activeIndex:u.value,total:e.urlList.length},()=>[Ae(De(a(me)),1)])],2)):h("v-if",!0),h(" ACTIONS "),v("div",{class:c([a(s).e("btn"),a(s).e("actions")])},[v("div",{class:c(a(s).e("actions__inner"))},[D(e.$slots,"toolbar",{actions:p,prev:V,next:Y,reset:M,activeIndex:u.value,setActiveItem:R},()=>[l(a(k),{onClick:t=>p("zoomOut")},{default:d(()=>[l(a(Pe))]),_:1},8,["onClick"]),l(a(k),{onClick:t=>p("zoomIn")},{default:d(()=>[l(a(Xe))]),_:1},8,["onClick"]),v("i",{class:c(a(s).e("actions__divider"))},null,2),l(a(k),{onClick:M},{default:d(()=>[(w(),ae(Be(a(L).icon)))]),_:1}),v("i",{class:c(a(s).e("actions__divider"))},null,2),l(a(k),{onClick:t=>p("anticlockwise")},{default:d(()=>[l(a(Fe))]),_:1},8,["onClick"]),l(a(k),{onClick:t=>p("clockwise")},{default:d(()=>[l(a(He))]),_:1},8,["onClick"])])],2)],2),h(" CANVAS "),v("div",{class:c(a(s).e("canvas"))},[(w(!0),E(P,null,We(e.urlList,(t,i)=>(w(),E(P,{key:i},[i===u.value?(w(),E("img",{key:0,ref_for:!0,ref:f=>H.value[i]=f,src:t,style:te(a(fe)),class:c(a(s).e("img")),crossorigin:e.crossorigin,onLoad:ge,onError:be,onMousedown:ke},null,46,["src","crossorigin"])):h("v-if",!0)],64))),128))],2),D(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var aa=Ce(ea,[["__file","image-viewer.vue"]]);const oa=Ke(aa);export{oa as E};

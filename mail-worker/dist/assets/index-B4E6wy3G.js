import{at as $,a9 as ut,aa as dt,a4 as ct,A as u,F as R,as as Ie,G as ne,e as S,o as s,g as i,a7 as r,p as d,h as b,q as o,j as ze,f as g,n as mt,i as c,t as l,Q as se,af as oe,ag as pt,ad as y,L as U}from"./index-92mnh-J5.js";import{E as ft}from"./el-overlay-jTA8uYnN.js";import{E as vt}from"./el-scrollbar-lgMH0mZQ.js";import{E as gt}from"./el-pagination-CxVfqRNt.js";import{a as yt}from"./el-tag-Dck20whD.js";import{a as ht,E as wt}from"./el-select-DGaDXl_M.js";/* empty css                 */import{E as bt,h as kt}from"./el-table-column-uawMUA32.js";import"./el-checkbox-DpAuy9Ti.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                        */import{b as St,E as _t,a as Ct}from"./el-dropdown-item-CgMmokvT.js";import{u as $t,r as ie}from"./role-C1oV9RuQ.js";import{I as T}from"./iconify-VCTUy_UH.js";import{l as Et}from"./index-UYGPyXpS.js";import{t as re}from"./day-DI1_lKIq.js";import{i as Vt}from"./verify-utils-D6Av2NDy.js";import{_ as Tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                       */import{E as It,a as Me}from"./el-radio-DGAw60Lp.js";import{E as zt}from"./vnode-DfneDD37.js";import{E as Mt}from"./index-CG9L6tLM.js";import{E as W}from"./index-B-u1Rqw0.js";import"./index-ChZfA3gH.js";import"./dayjs.min-BodJrPHb.js";import"./validator-Cw4sOcG_.js";function At(v){return $.get("/user/list",{params:{...v}})}function Dt(v){return $.put("/user/setPwd",v)}function Rt(v){return $.put("/user/setStatus",v)}function Ut(v){return $.put("/user/setType",v)}function Pt(v){return $.delete("/user/delete",{params:{userId:v}})}function Bt(v){return $.post("/user/add",v)}function Lt(v){return $.put("/user/resetSendCount",{userId:v})}function Yt(v,a){return $.put("/user/restore",{userId:v,type:a})}const Nt={class:"user-box"},Ft={class:"header-actions"},Wt={class:"search"},jt={class:"details"},Ht={key:0},Ot={class:"details-item-title"},Gt={key:1},Jt={class:"details-item-title"},qt={key:2},Qt={class:"details-item-title"},Kt={key:3},Xt={class:"details-item-title"},Zt={key:4},xt={class:"details-item-title"},el={class:"details-item-title"},tl={class:"details-item-title"},ll={class:"details-item-title"},al={class:"details-item-title"},nl={class:"details-item-title"},sl={class:"details-item-title"},ol={class:"details-item-title"},il={class:"email-row"},rl={class:"type"},ul={key:0,class:"pagination"},dl={class:"dialog-box"},cl={class:"dialog-box"},ml={class:"container"},pl=Object.assign({name:"user"},{__name:"index",setup(v){const{t:a,locale:ue}=ut(),Ae=$t(),De=dt(),j=ct(),H=["normal","del"],O=[{text:a("active"),value:"normal"},{text:a("deleted"),value:"del"}],Re=u(!1),de=u(230),ce=u(40),me=u(null),G=u(!0),J=u(!0),q=u(!0),Q=u(!0),K=u(!0),pe=u(null),fe=u(!1),ve=u("prev, pager, next,  sizes, total"),X=u(""),Z=u(!1),ge=u([]),P=u(0),x=u(!0),ye=u(null),Ue=j.domainList,p=R({email:"",suffix:j.domainList[0],password:"",type:null}),m=R({email:"",num:1,size:15,timeSort:0,status:-1});let he={};const f=R({password:null,type:-1,userId:0}),B=u(!1),L=u(!1),Y=u(!1),N=u(!1),ee=u(10),I=u(!1),te=u(!0),k=R([]),we=u({}),be=u(0);ie().then(e=>{k.length=0,k.push(...e)});const z=Ie.getJSON("user-params");z&&(m.num=z.num,m.size=z.size,m.timeSort=z.timeSort,m.status=z.status);let le=null;ne(()=>m,async()=>{le&&clearTimeout(le),le=setTimeout(async()=>{await Ie.setJSON("user-params",m)},500)},{deep:!0}),ne(()=>Ae.refresh,()=>{ie().then(e=>{k.length=0,k.push(...e)})}),ne(()=>De.refreshList,()=>{_(!1)}),_();const h=R({send:["normal","del"],account:["normal","del"],receive:["normal","del"]});function Pe(e){e.send&&(h.send=e.send),e.account&&(h.account=e.account),e.receive&&(h.receive=e.receive)}function Be(e){return h.send.length===2?e.sendEmailCount+e.delSendEmailCount:h.send.includes("normal")?e.sendEmailCount:h.send.includes("del")?e.delSendEmailCount:0}function Le(e){return h.account.length===2?e.accountCount+e.delAccountCount:h.account.includes("normal")?e.accountCount:h.account.includes("del")?e.delAccountCount:0}function Ye(e){return h.receive.length===2?e.receiveEmailCount+e.delReceiveEmailCount:h.receive.includes("normal")?e.receiveEmailCount:h.receive.includes("del")?e.delReceiveEmailCount:0}function Ne(e){if(e.isDel===1)return a("restore");if(e.status===0)return a("btnBan");if(e.status===1)return a("enable")}const Fe=e=>e.row.email;function We(){Z.value=!Z.value,be.value++}const je=()=>{we.value.toggleMenu()};function He(){p.email="",p.suffix=j.domainList[0],p.type=null,p.password=""}function Oe(){B.value=!0}function Ge(){if(!p.email){y({message:a("emptyEmailMsg"),type:"error",plain:!0});return}if(!Vt(p.email+p.suffix)){y({message:a("notEmailMsg"),type:"error",plain:!0});return}if(!p.password){y({message:a("emptyPwdMsg"),type:"error",plain:!0});return}if(p.password.length<6){y({message:a("pwdLengthMsg"),type:"error",plain:!0});return}if(!p.type){y({message:a("emptyRole"),type:"error",plain:!0});return}L.value=!0;const e={...p};e.email=e.email+e.suffix,Bt(e).then(()=>{L.value=!1,B.value=!1,y({message:a("addSuccessMsg"),type:"success",plain:!0}),He(),_(!1)}).finally(n=>{L.value=!1})}function Je(e){if(e.sendAction.sendType==="day")return a("daily");if(e.sendAction.sendType==="count")return a("total");if(e.sendAction.sendType==="ban")return a("sendBanned")}function qe(e){return e.sendAction.hasPerm?e.sendAction.sendCount?e.sendCount+"/"+e.sendAction.sendCount:a("unlimited"):a("unauthorized")}function ke(e){if(e===0)return a("admin");const n=k.findIndex(w=>w.roleId===e);return n>-1?k[n].name:""}function Qe(e){W.confirm(a("reSendConfirm",{msg:e.email}),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{Lt(e.userId).then(()=>{y({message:a("reSuccessMsg"),type:"success",plain:!0}),e.sendCount=0})})}function Ke(e){W.confirm(a("delConfirm",{msg:e.email}),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{Pt(e.userId).then(()=>{y({message:a("delSuccessMsg"),type:"success",plain:!0}),_(!1)})})}function Xe(e){const n=u(0);W.confirm(null,{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),message:()=>U("div",[U("div",{class:"mb-2"},a("restoreConfirm",{msg:e.email})),U(It,{modelValue:n.value,"onUpdate:modelValue":w=>n.value=w},[U(Me,{label:"option1",value:0},a("normalRestore")),U(Me,{label:"option2",value:1},a("allRestore"))])]),type:"warning"}).then(()=>{Yt(e.userId,n.value).then(()=>{e.isDel=0,y({message:a("restoreSuccessMsg"),type:"success",plain:!0})})})}function Ze(e){e.status===0?W.confirm(a("banRestore",{msg:e.email}),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{Se(e)}):Se(e)}function Se(e){let n=e.status?0:1;Rt({status:n,userId:e.userId}).then(()=>{e.status=n,y({message:a("saveSuccessMsg"),type:"success",plain:!0})})}function xe(){I.value=!0,Ut({type:f.type,userId:f.userId}).then(()=>{he.type=f.type,Y.value=!1,y({message:a("saveSuccessMsg"),type:"success",plain:!0})}).finally(()=>{I.value=!1})}function _e(){f.password=null,f.userId=0}function et(){m.num=1,_()}function tt(){if(!f.password){y({message:a("emptyPwdMsg"),type:"error",plain:!0});return}if(f.password.length<6){y({message:a("pwdLengthMsg"),type:"error",plain:!0});return}I.value=!0,Dt({password:f.password,userId:f.userId}).then(()=>{N.value=!1,y({message:a("saveSuccessMsg"),type:"success",plain:!0})}).finally(()=>{I.value=!1})}function lt(e){he=e,f.userId=e.userId,f.type=e.type,Y.value=!0}function at(e){f.userId=e.userId,N.value=!0}function nt(){m.email="",m.num=1,m.status=-1,m.timeSort=0,_(),ie().then(e=>{k.length=0,k.push(...e)})}function Ce(){m.num=1,m.timeSort=m.timeSort?0:1,_()}function $e(e){m.num=e,_()}function Ee(e){m.size=e,_()}function _(e=!0){te.value=e;const n={...m};n.status===-2&&(delete n.status,n.isDel=1),At(n).then(w=>{ge.value=w.list,P.value=w.total,ye.value?.setScrollTop(0)}).finally(()=>{te.value=!1,setTimeout(()=>{x.value=!1},200)})}window.onresize=()=>{Ve()},Ve();function Ve(){const e=window.innerWidth;Q.value=e>1090,q.value=e>1367,J.value=e>650,G.value=e>685,K.value=e>767,de.value=e>480?230:null,me.value=e<480?ue.value==="en"?85:75:null,ce.value=e<480?25:40,ee.value=e<768?7:11,pe.value=e<480?90:null,ve.value=e<768?"pager":"prev, pager, next,sizes, total",fe.value=e<768,X.value=e<380?"small":""}return(e,n)=>{const w=zt,E=ht,F=wt,V=yt,M=Mt,C=kt,A=Ct,st=_t,ot=St,it=bt,Te=gt,rt=vt,ae=ft;return s(),S("div",Nt,[i("div",Ft,[r(b(T),{class:"icon",icon:"ion:add-outline",width:"23",height:"23",onClick:Oe}),i("div",Wt,[r(w,{modelValue:m.email,"onUpdate:modelValue":n[0]||(n[0]=t=>m.email=t),class:"search-input",placeholder:e.$t("searchByEmail")},null,8,["modelValue","placeholder"])]),r(F,{modelValue:m.status,"onUpdate:modelValue":n[1]||(n[1]=t=>m.status=t),placeholder:"Select",class:"status-select",style:ze(`width: ${b(ue)==="en"?95:80}px`)},{default:o(()=>[(s(),d(E,{key:-1,label:e.$t("all"),value:-1},null,8,["label"])),(s(),d(E,{key:0,label:e.$t("active"),value:0},null,8,["label"])),(s(),d(E,{key:1,label:e.$t("banned"),value:1},null,8,["label"])),(s(),d(E,{key:-2,label:e.$t("deleted"),value:-2},null,8,["label"]))]),_:1},8,["modelValue","style"]),r(b(T),{class:"icon",icon:"iconoir:search",onClick:et,width:"20",height:"20"}),m.timeSort===1?(s(),d(b(T),{key:0,class:"icon",onClick:Ce,icon:"material-symbols-light:timer-arrow-down-outline",width:"28",height:"28"})):(s(),d(b(T),{key:1,class:"icon",onClick:Ce,icon:"material-symbols-light:timer-arrow-up-outline",width:"28",height:"28"})),r(b(T),{class:"icon",icon:"ion:reload",width:"18",height:"18",onClick:nt}),r(b(T),{class:"icon",icon:"pepicons-pencil:expand",width:"26",height:"26",onClick:We})]),r(rt,{ref_key:"scrollbarRef",ref:ye,class:"scrollbar"},{default:o(()=>[i("div",null,[i("div",{class:mt(["loading",te.value?"loading-show":"loading-hide"]),style:ze(x.value?"background: transparent":"")},[r(Et)],6),(s(),d(it,{onFilterChange:Pe,"empty-text":x.value?"":null,"default-expand-all":Z.value,data:ge.value,"preserve-expanded-content":Re.value,style:{width:"100%"},key:be.value},{default:o(()=>[r(C,{width:ce.value,type:"expand"},{default:o(t=>[i("div",jt,[G.value?g("",!0):(s(),S("div",Ht,[i("span",Ot,l(e.$t("tabSent"))+":",1),c(l(t.row.sendEmailCount),1)])),J.value?g("",!0):(s(),S("div",Gt,[i("span",Jt,l(e.$t("tabMailboxes"))+":",1),c(l(t.row.accountCount),1)])),q.value?g("",!0):(s(),S("div",qt,[i("span",Qt,l(e.$t("tabRegisteredAt"))+":",1),c(l(b(re)(t.row.createTime).format("YYYY-MM-DD HH:mm")),1)])),K.value?g("",!0):(s(),S("div",Kt,[i("span",Xt,l(e.$t("perm"))+":",1),c(" "+l(ke(t.row.type)),1)])),Q.value?g("",!0):(s(),S("div",Zt,[i("span",xt,l(e.$t("tabStatus"))+":",1),t.row.isDel===1?(s(),d(V,{key:0,"disable-transitions":"",type:"info"},{default:o(()=>[c(l(e.$t("deleted")),1)]),_:1})):t.row.status===0?(s(),d(V,{key:1,"disable-transitions":"",type:"primary"},{default:o(()=>[c(l(e.$t("active")),1)]),_:1})):t.row.status===1?(s(),d(V,{key:2,"disable-transitions":"",type:"danger"},{default:o(()=>[c(l(e.$t("banned")),1)]),_:1})):g("",!0)])),i("div",null,[i("span",el,l(e.$t("registrationIp"))+":",1),c(l(t.row.createIp||e.$t("unknown")),1)]),i("div",null,[i("span",tl,l(e.$t("recentIP"))+":",1),c(l(t.row.activeIp||e.$t("unknown")),1)]),i("div",null,[i("span",ll,l(e.$t("recentActivity"))+":",1),c(l(t.row.activeTime?b(re)(t.row.activeTime).format("YYYY-MM-DD"):e.$t("unknown")),1)]),i("div",null,[i("span",al,l(e.$t("loginDevice"))+":",1),c(l(t.row.device||e.$t("unknown")),1)]),i("div",null,[i("span",nl,l(e.$t("loginSystem"))+":",1),c(l(t.row.os||e.$t("unknown")),1)]),i("div",null,[i("span",sl,l(e.$t("browserLogin"))+":",1),c(l(t.row.browser||e.$t("unknown")),1)]),i("div",null,[i("span",ol,l(e.$t("sendEmail"))+":",1),i("span",null,l(qe(t.row)),1),t.row.sendAction.hasPerm?(s(),d(V,{key:0,style:{"margin-left":"10px"}},{default:o(()=>[c(l(Je(t.row)),1)]),_:2},1024)):g("",!0),t.row.sendAction.hasPerm&&t.row.sendAction.sendCount?(s(),d(M,{key:1,size:"small",style:{"margin-left":"10px"},onClick:D=>Qe(t.row),type:"primary"},{default:o(()=>[c(l(e.$t("reset")),1)]),_:2},1032,["onClick"])):g("",!0)])])]),_:1},8,["width"]),r(C,{"show-overflow-tooltip":"","tooltip-formatter":Fe,label:e.$t("tabEmailAddress"),"min-width":de.value},{default:o(t=>[i("div",il,l(t.row.email),1)]),_:1},8,["label","min-width"]),r(C,{formatter:Ye,"label-class-name":"receive","column-key":"receive","filtered-value":H,filters:O,width:pe.value,label:e.$t("tabReceived"),prop:"receiveEmailCount"},null,8,["width","label"]),G.value?(s(),d(C,{key:0,formatter:Be,"label-class-name":"send","column-key":"send","filtered-value":H,filters:O,label:e.$t("tabSent"),prop:"sendEmailCount"},null,8,["label"])):g("",!0),J.value?(s(),d(C,{key:1,formatter:Le,"label-class-name":"account","column-key":"account","filtered-value":H,filters:O,label:e.$t("tabMailboxes"),prop:"accountCount"},null,8,["label"])):g("",!0),q.value?(s(),d(C,{key:2,label:e.$t("tabRegisteredAt"),"min-width":"160",prop:"createTime"},{default:o(t=>[c(l(b(re)(t.row.createTime).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label"])):g("",!0),Q.value?(s(),d(C,{key:3,"min-width":"60px",label:e.$t("tabStatus"),prop:"status"},{default:o(t=>[t.row.isDel===1?(s(),d(V,{key:0,"disable-transitions":"",type:"info"},{default:o(()=>[c(l(e.$t("deleted")),1)]),_:1})):t.row.status===0?(s(),d(V,{key:1,"disable-transitions":"",type:"primary"},{default:o(()=>[c(l(e.$t("active")),1)]),_:1})):t.row.status===1?(s(),d(V,{key:2,"disable-transitions":"",type:"danger"},{default:o(()=>[c(l(e.$t("banned")),1)]),_:1})):g("",!0)]),_:1},8,["label"])):g("",!0),K.value?(s(),d(C,{key:4,label:e.$t("tabRole"),"min-width":"140",prop:"type"},{default:o(t=>[i("div",rl,l(ke(t.row.type)),1)]),_:1},8,["label"])):g("",!0),r(C,{label:e.$t("tabSetting"),width:me.value},{default:o(t=>[r(ot,{trigger:"click"},{dropdown:o(()=>[r(st,null,{default:o(()=>[r(A,{onClick:D=>at(t.row)},{default:o(()=>[c(l(e.$t("chgPwd")),1)]),_:2},1032,["onClick"]),r(A,{onClick:D=>lt(t.row)},{default:o(()=>[c(l(e.$t("perm")),1)]),_:2},1032,["onClick"]),t.row.isDel!==1?(s(),d(A,{key:0,onClick:D=>Ze(t.row)},{default:o(()=>[c(l(Ne(t.row)),1)]),_:2},1032,["onClick"])):(s(),d(A,{key:1,onClick:D=>Xe(t.row)},{default:o(()=>[c(l(e.$t("restore")),1)]),_:2},1032,["onClick"])),r(A,{onClick:D=>Ke(t.row)},{default:o(()=>[c(l(e.$t("delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[r(M,{size:"small",type:"primary"},{default:o(()=>[c(l(e.$t("action")),1)]),_:1})]),_:2},1024)]),_:1},8,["label","width"])]),_:1},8,["empty-text","default-expand-all","data","preserve-expanded-content"])),P.value>10?(s(),S("div",ul,[r(Te,{size:X.value,"current-page":m.num,"page-size":m.size,"pager-count":ee.value,"page-sizes":[10,15,20,25,30,50],background:"",layout:ve.value,total:P.value,onSizeChange:Ee,onCurrentChange:$e},null,8,["size","current-page","page-size","pager-count","layout","total"]),fe.value?(s(),d(Te,{key:0,size:X.value,"current-page":m.num,"page-size":m.size,"pager-count":ee.value,"page-sizes":[10,15,20,25,30,50],background:"",layout:"sizes, total",total:P.value,onSizeChange:Ee,onCurrentChange:$e},null,8,["size","current-page","page-size","pager-count","total"])):g("",!0)])):g("",!0)])]),_:1},512),r(ae,{class:"dialog",modelValue:N.value,"onUpdate:modelValue":n[3]||(n[3]=t=>N.value=t),title:e.$t("changePassword"),onClosed:_e},{default:o(()=>[i("div",dl,[r(w,{modelValue:f.password,"onUpdate:modelValue":n[2]||(n[2]=t=>f.password=t),type:"password",placeholder:e.$t("newPassword"),autocomplete:"off"},null,8,["modelValue","placeholder"]),r(M,{class:"btn",type:"primary",loading:I.value,onClick:tt},{default:o(()=>[c(l(e.$t("save")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue","title"]),r(ae,{class:"dialog",modelValue:Y.value,"onUpdate:modelValue":n[5]||(n[5]=t=>Y.value=t),title:e.$t("changePerm"),onClosed:_e},{default:o(()=>[i("div",cl,[f.type===0?(s(),d(w,{key:0,disabled:"","model-value":e.$t("admin")},null,8,["model-value"])):(s(),d(F,{key:1,modelValue:f.type,"onUpdate:modelValue":n[4]||(n[4]=t=>f.type=t),placeholder:"Select"},{default:o(()=>[(s(!0),S(se,null,oe(k,t=>(s(),d(E,{label:t.name,value:t.roleId,key:t.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])),r(M,{disabled:f.type===0,class:"btn",loading:I.value,type:"primary",onClick:xe},{default:o(()=>[c(l(e.$t("save")),1)]),_:1},8,["disabled","loading"])])]),_:1},8,["modelValue","title"]),r(ae,{modelValue:B.value,"onUpdate:modelValue":n[10]||(n[10]=t=>B.value=t),title:e.$t("addUser")},{default:o(()=>[i("div",ml,[r(w,{modelValue:p.email,"onUpdate:modelValue":n[7]||(n[7]=t=>p.email=t),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},{append:o(()=>[i("div",{onClick:pt(je,["stop"])},[r(F,{ref_key:"mySelect",ref:we,modelValue:p.suffix,"onUpdate:modelValue":n[6]||(n[6]=t=>p.suffix=t),placeholder:e.$t("select"),class:"select"},{default:o(()=>[(s(!0),S(se,null,oe(b(Ue),t=>(s(),d(E,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),i("div",null,[i("span",null,l(p.suffix),1),r(b(T),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),_:1},8,["modelValue","placeholder"]),r(w,{type:"password",modelValue:p.password,"onUpdate:modelValue":n[8]||(n[8]=t=>p.password=t),placeholder:e.$t("password")},null,8,["modelValue","placeholder"]),r(F,{modelValue:p.type,"onUpdate:modelValue":n[9]||(n[9]=t=>p.type=t),placeholder:e.$t("perm")},{default:o(()=>[(s(!0),S(se,null,oe(k,t=>(s(),d(E,{label:t.name,value:t.roleId,key:t.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),r(M,{class:"btn",type:"primary",onClick:Ge,loading:L.value},{default:o(()=>[c(l(e.$t("add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue","title"])])}}}),Fl=Tt(pl,[["__scopeId","data-v-290a2932"]]);export{Fl as default};

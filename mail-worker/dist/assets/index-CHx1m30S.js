import{at as V,a4 as Me,F as T,a9 as Te,A as g,G as ke,e as h,o as u,g as a,a7 as n,h as v,q as s,f as L,j as Ve,n as O,Q as q,af as G,t as d,p as k,i as y,ag as Ke,ad as p}from"./index-92mnh-J5.js";import{E as $e,h as be}from"./el-table-column-uawMUA32.js";import"./el-checkbox-DpAuy9Ti.js";import"./el-tooltip-l0sNRNKZ.js";import{a as De}from"./el-tag-Dck20whD.js";import{E as Ye}from"./el-scrollbar-lgMH0mZQ.js";import{E as Ue}from"./el-overlay-jTA8uYnN.js";/* empty css                  *//* empty css                 */import{E as Ie}from"./el-input-number-Bip_U3ji.js";import{E as Se}from"./el-date-picker-panel-BKCkkkEQ.js";import{E as xe,a as He}from"./el-select-DGaDXl_M.js";import{E as Be}from"./el-empty-CKfYwwv3.js";/* empty css                        */import{b as Le,E as Ne,a as Re}from"./el-dropdown-item-CgMmokvT.js";import{I as w}from"./iconify-VCTUy_UH.js";import{l as P}from"./index-UYGPyXpS.js";import{u as Ae,r as Q}from"./role-C1oV9RuQ.js";import{g as Z}from"./text-C9KP7X7d.js";import{d as J}from"./dayjs.min-BodJrPHb.js";import{t as X}from"./day-DI1_lKIq.js";import{c as Fe}from"./clipboard-utils-Bf-9Um4a.js";/* empty css                       */import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as je}from"./vnode-DfneDD37.js";import{E as We}from"./index-CG9L6tLM.js";import{E as ee}from"./index-B-u1Rqw0.js";import"./index-ChZfA3gH.js";import"./index-C8SbU5-9.js";import"./validator-Cw4sOcG_.js";function Oe(f){return V.get("/regKey/list",{params:{...f}})}function qe(f){return V.post("/regKey/add",f)}function Ge(f){return V.delete("/regKey/delete?regKeyIds="+f)}function Pe(){return V.delete("/regKey/clearNotUse")}function Qe(f){return V.get("/regKey/history",{params:{regKeyId:f}})}const Ze={class:"reg-key"},Je={class:"header-actions"},Xe={class:"search"},et={class:"code-box"},tt={class:"code-item"},ot={class:"code-info"},nt={class:"info-left"},lt={class:"info-left-item"},rt=["onClick"],at={class:"info-left-item"},st={key:0},it={class:"info-left-item"},ct={class:"info-left-item"},dt={key:0},ut={class:"info-right"},mt={key:0,class:"empty"},pt={class:"container"},ft=Object.assign({name:"reg-key"},{__name:"index",setup(f){const te=Ae(),N=Me(),K=T({code:""}),{t:c}=Te(),C=T([]),U=g(!1),b=g(!1),I=g(!0),S=g(!0),x=g(!1),H=T([]),E=g(0),R=g(0),D=g(!1),oe=window.innerWidth<1025,i=T({code:"",count:1,roleId:null,expireTime:null}),Y=T([]);_(!0),Q().then(t=>{C.length=0,C.push(...t)}),ke(()=>te.refresh,()=>{Q().then(t=>{C.length=0,C.push(...t)})});function ne(t){H.length=0,D.value=!0,Qe(t.regKeyId).then(e=>{if(H.push(...e),e.length>0){const l=e.reduce((m,M)=>A(m,M,"email")).email;E.value=Z(l)+30,E.value=E.value<300?E.value:300;const r=e.reduce((m,M)=>A(m,M,"createTime")).createTime;R.value=Z(r)}}).finally(()=>{D.value=!1}),x.value=!0}const A=(t,e,l)=>{const r=m=>(m.match(/[A-Z]/g)||[]).length;return t[l].length===e[l].length?r(t[l])>r(e[l])?t:e:t[l].length>e[l].length?t:e};function le(t){const e=X(t.createTime),l=J().year(),r=e.year();return N.lang==="en"?r===l?e.format("MMM D, HH:mm"):e.format("MMM D, YYYY HH:mm"):r===l?e.format("M月D日 HH:mm"):e.format("YYYY年M月D日 HH:mm")}function re(t){const e=X(t),l=J().year(),r=e.year();return N.lang==="en"?r===l?e.format("MMM D"):e.format("MMM D, YYYY"):r===l?e.format("M月D日"):e.format("YYYY年M月D日")}function ae(){K.code=null,_(!0)}function se(){_(!0)}function _(t=!1){t&&(I.value=!0),Oe(K).then(e=>{Y.length=0,Y.push(...e),I.value=!1,setTimeout(()=>{S.value=!1},200)})}async function F(t){try{await Fe(t),p({message:c("copySuccessMsg"),type:"success",plain:!0})}catch(e){console.error("复制失败:",e),p({message:"复制失败",type:"error",plain:!0})}}function z(){i.code=ie()}function ie(t=8){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let r=0;r<t;r++)l+=e.charAt(Math.floor(Math.random()*e.length));return l}function ce(){ee.confirm(c("clearRegKey"),{confirmButtonText:c("confirm"),cancelButtonText:c("cancel"),type:"warning"}).then(()=>{Pe().then(()=>{p({message:c("clearSuccess"),type:"success",plain:!0}),_()})})}function de(){if(!i.code){p({message:$("emptyRegKeyMsg"),type:"error",plain:!0});return}if(!i.roleId){p({message:c("emptyRole"),type:"error",plain:!0});return}if(!i.expireTime){p({message:c("emptyTimeMsg"),type:"error",plain:!0});return}if(!i.count){p({message:c("emptyCountMsg"),type:"error",plain:!0});return}U.value=!0,qe(i).then(()=>{b.value=!1,me(),p({message:c("addSuccessMsg"),type:"success",plain:!0}),_()}).finally(()=>{U.value=!1})}function ue(t){ee.confirm(c("delConfirm",{msg:t.code}),{confirmButtonText:c("confirm"),cancelButtonText:c("cancel"),type:"warning"}).then(()=>{Ge([t.regKeyId]).then(()=>{_(),p({message:c("delSuccessMsg"),type:"success",plain:!0})})})}function me(){i.code=""}function pe(){z(),b.value=!0}return(t,e)=>{const l=je,r=De,m=Re,M=Ne,fe=Le,ge=Be,he=Ye,ye=He,_e=xe,ve=Se,we=Ie,Ce=We,j=Ue,W=be,Ee=$e;return u(),h("div",Ze,[a("div",Je,[n(v(w),{class:"icon",icon:"ion:add-outline",width:"23",height:"23",onClick:pe}),a("div",Xe,[n(l,{modelValue:K.code,"onUpdate:modelValue":e[0]||(e[0]=o=>K.code=o),class:"search-input",placeholder:t.$t("searchRegKeyDesc")},null,8,["modelValue","placeholder"])]),n(v(w),{class:"icon",icon:"iconoir:search",onClick:se,width:"20",height:"20"}),n(v(w),{class:"icon",icon:"ion:reload",width:"18",height:"18",onClick:ae}),n(v(w),{class:"icon",icon:"fluent:broom-sparkle-16-regular",width:"22",height:"22",onClick:ce})]),n(he,{class:"scrollbar"},{default:s(()=>[a("div",{class:O(["loading",I.value?"loading-show":"loading-hide"]),style:Ve(S.value?"background: transparent":"")},[n(P)],6),a("div",et,[(u(!0),h(q,null,G(Y,o=>(u(),h("div",tt,[a("div",ot,[a("div",nt,[a("div",lt,[a("span",{class:"code",onClick:B=>F(o.code)},d(o.code),9,rt)]),a("div",at,[a("div",null,d(t.$t("remainingUses"))+"：",1),o.count?(u(),h("div",st,d(o.count),1)):(u(),k(r,{key:1,type:"danger"},{default:s(()=>[y(d(t.$t("exhausted")),1)]),_:1}))]),a("div",it,[a("div",null,d(t.$t("roleDesc"))+"：",1),n(r,null,{default:s(()=>[y(d(o.roleName),1)]),_:2},1024)]),a("div",ct,[a("div",null,d(t.$t("validUntil"))+"：",1),o.expireTime?(u(),h("div",dt,d(re(o.expireTime)),1)):(u(),k(r,{key:1,type:"danger"},{default:s(()=>[y(d(t.$t("expired")),1)]),_:1}))])]),a("div",ut,[n(fe,{class:"setting"},{dropdown:s(()=>[n(M,null,{default:s(()=>[n(m,{onClick:B=>F(o.code)},{default:s(()=>[y(d(t.$t("copy")),1)]),_:2},1032,["onClick"]),n(m,{onClick:B=>ne(o)},{default:s(()=>[y(d(t.$t("history")),1)]),_:2},1032,["onClick"]),n(m,{onClick:B=>ue(o)},{default:s(()=>[y(d(t.$t("delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[n(v(w),{icon:"fluent:settings-24-filled",width:"21",height:"21",color:"#909399"})]),_:2},1024)])])]))),256))]),Y.length===0?(u(),h("div",mt,[S.value?L("",!0):(u(),k(ge,{key:0,"image-size":oe?120:0,description:t.$t("noCodeFound")},null,8,["image-size","description"]))])):L("",!0)]),_:1}),n(j,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=o=>b.value=o),title:t.$t("addRegKey")},{default:s(()=>[a("div",pt,[n(l,{modelValue:i.code,"onUpdate:modelValue":e[1]||(e[1]=o=>i.code=o),placeholder:t.$t("regKey")},{suffix:s(()=>[n(v(w),{onClick:Ke(z,["stop"]),class:"gen-code",icon:"bitcoin-icons:refresh-filled",width:"24",height:"24"})]),_:1},8,["modelValue","placeholder"]),n(_e,{modelValue:i.roleId,"onUpdate:modelValue":e[2]||(e[2]=o=>i.roleId=o),placeholder:t.$t("roleDesc")},{default:s(()=>[(u(!0),h(q,null,G(C,o=>(u(),k(ye,{label:o.name,value:o.roleId,key:o.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(ve,{modelValue:i.expireTime,"onUpdate:modelValue":e[3]||(e[3]=o=>i.expireTime=o),type:"date",placeholder:t.$t("validUntil")},null,8,["modelValue","placeholder"]),n(we,{modelValue:i.count,"onUpdate:modelValue":e[4]||(e[4]=o=>i.count=o),min:1,max:99999},null,8,["modelValue"]),n(Ce,{class:"btn",type:"primary",onClick:de,loading:U.value},{default:s(()=>[y(d(t.$t("add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue","title"]),n(j,{class:"history-list",modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value=o),title:t.$t("useHistory")},{default:s(()=>[a("div",{class:O(["loading",D.value?"loading-show":"loading-hide"])},[n(P)],2),D.value?L("",!0):(u(),k(Ee,{key:0,data:H,fit:!0,style:{height:"100%"}},{default:s(()=>[n(W,{"min-width":E.value,property:"email",label:t.$t("user"),"show-overflow-tooltip":!0},null,8,["min-width","label"]),n(W,{width:R.value,formatter:le,property:"createTime",label:t.$t("date"),fixed:"right","show-overflow-tooltip":!0},null,8,["width","label"])]),_:1},8,["data"]))]),_:1},8,["modelValue","title"])])}}}),Wt=ze(ft,[["__scopeId","data-v-f0891234"]]);export{Wt as default};

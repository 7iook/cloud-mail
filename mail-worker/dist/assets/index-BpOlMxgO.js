import{a9 as Z,ae as ee,aa as te,ab as oe,a4 as le,A as w,F as D,a1 as B,l as R,ap as se,e as d,g as r,h as n,bf as ae,j as re,O as I,f as V,t as i,P,a7 as f,bg as ne,q as b,n as ie,p as h,Q as K,i as M,bh as ue,o as a,ag as x,af as z,ad as c,as as de,bi as ce,bj as pe,a8 as j}from"./index-92mnh-J5.js";/* empty css                  *//* empty css                 */import"./el-tag-Dck20whD.js";import{E as me,a as ge}from"./el-select-DGaDXl_M.js";import"./el-scrollbar-lgMH0mZQ.js";import{a as fe,r as ve}from"./login-axc5DUUL.js";import{i as q}from"./verify-utils-D6Av2NDy.js";import{I as J}from"./iconify-VCTUy_UH.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as we}from"./vnode-DfneDD37.js";import{E as ke}from"./index-CG9L6tLM.js";import"./index-ChZfA3gH.js";const Ve={id:"login-box"},be={key:0,id:"background-wrap"},he={class:"form-wrapper"},Se={class:"container"},$e={class:"form-title"},Ee={key:0,class:"form-desc"},Me={key:1,class:"form-desc"},Ce={style:{color:"var(--el-text-color-primary)"}},Ue=["data-sitekey"],_e={key:0,style:{"font-size":"12px",color:"#F56C6C"}},Te={__name:"index",setup(Ae){ue(e=>({"808818f8":H.value}));const{t:u}=Z(),Q=ee(),G=te(),O=oe(),s=le(),C=w(!1),m=w("login"),v=D({email:"",password:""}),U=w(),p=w(""),l=D({email:"",password:"",confirmPassword:"",code:null}),_=s.domainList,E=w(!1);p.value=_[0];const S=w(!1);let $="",y=null,T=w(!1),F=0;window.onTurnstileSuccess=e=>{$=e},window.onTurnstileError=e=>{F>=4||(F++,console.warn("人机验加载失败",e),setTimeout(()=>{B(()=>{y?window.turnstile.reset(y):y=window.turnstile.render(".register-turnstile")})},1500))},window.loadAfter=e=>{console.log("loadAfter")},window.loadBefore=e=>{console.log("loadBefore")};const H=R(()=>{const e=s.settings.loginOpacity;return O.dark?`rgba(0, 0, 0, ${e})`:`rgba(255, 255, 255, ${e})`}),W=R(()=>s.settings.background?{"background-image":`url(${se(s.settings.background)})`,"background-repeat":"no-repeat","background-size":"cover","background-position":"center"}:""),L=()=>{U.value.toggleMenu()},X=()=>{if(!v.email){c({message:u("emptyEmailMsg"),type:"error",plain:!0});return}let e=v.email+(s.settings.loginDomain===0?p.value:"");if(!q(e)){c({message:u("notEmailMsg"),type:"error",plain:!0});return}if(!v.password){c({message:u("emptyPwdMsg"),type:"error",plain:!0});return}C.value=!0,fe(e,v.password).then(async t=>{await de.setItem("token",t.token);const k=await ce();Q.currentAccountId=k.accountId,G.user=k,pe(k.permKeys).forEach(g=>{j.addRoute("layout",g)}),await j.replace({name:"layout"}),O.showNotice()}).finally(()=>{C.value=!1})};function Y(){if(!l.email){c({message:u("emptyEmailMsg"),type:"error",plain:!0});return}if(!q(l.email+p.value)){c({message:u("notEmailMsg"),type:"error",plain:!0});return}if(!l.password){c({message:u("emptyPwdMsg"),type:"error",plain:!0});return}if(l.password.length<6){c({message:u("pwdLengthMsg"),type:"error",plain:!0});return}if(l.password!==l.confirmPassword){c({message:u("confirmPwdFailMsg"),type:"error",plain:!0});return}if(s.settings.regKey===0&&!l.code){c({message:u("emptyRegKeyMsg"),type:"error",plain:!0});return}if(!$&&(s.settings.registerVerify===0||s.settings.registerVerify===2&&s.settings.regVerifyOpen)){S.value?T.value||c({message:u("botVerifyMsg"),type:"error",plain:!0}):(S.value=!0,B(()=>{if(y)window.turnstile.reset(".register-turnstile");else try{y=window.turnstile.render(".register-turnstile")}catch{T.value=!0,console.log("人机验证js加载失败")}}));return}E.value=!0;const e={email:l.email+p.value,password:l.password,token:$,code:l.code};ve(e).then(({regVerifyOpen:t})=>{m.value="login",l.email="",l.password="",l.confirmPassword="",l.code="",E.value=!1,$="",s.settings.regVerifyOpen=t,S.value=!1,c({message:u("regSuccessMsg"),type:"success",plain:!0})}).catch(t=>{E.value=!1,t.code===400&&($="",s.settings.regVerifyOpen=!0,y?window.turnstile.reset(y):B(()=>{y=window.turnstile.render(".register-turnstile")}),S.value=!0)})}return(e,t)=>{const k=ge,A=me,g=we,N=ke;return a(),d("div",Ve,[n(s).settings.background?(a(),d("div",{key:1,style:re(W.value)},null,4)):(a(),d("div",be,[...t[11]||(t[11]=[ae('<div class="x1 cloud" data-v-645032c7></div><div class="x2 cloud" data-v-645032c7></div><div class="x3 cloud" data-v-645032c7></div><div class="x4 cloud" data-v-645032c7></div><div class="x5 cloud" data-v-645032c7></div>',5)])])),r("div",he,[r("div",Se,[r("span",$e,i(n(s).settings.title),1),m.value==="login"?(a(),d("span",Ee,i(e.$t("loginTitle")),1)):(a(),d("span",Me,i(e.$t("regTitle")),1)),I(r("div",null,[f(g,{class:ie(n(s).settings.loginDomain===0?"email-input":""),modelValue:v.email,"onUpdate:modelValue":t[1]||(t[1]=o=>v.email=o),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},ne({_:2},[n(s).settings.loginDomain===0?{name:"append",fn:b(()=>[r("div",{onClick:x(L,["stop"])},[m.value==="login"?(a(),h(A,{key:0,ref_key:"mySelect",ref:U,modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),placeholder:e.$t("select"),class:"select"},{default:b(()=>[(a(!0),d(K,null,z(n(_),o=>(a(),h(k,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):V("",!0),r("div",Ce,[r("span",null,i(p.value),1),f(n(J),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),key:"0"}:void 0]),1032,["class","modelValue","placeholder"]),f(g,{modelValue:v.password,"onUpdate:modelValue":t[2]||(t[2]=o=>v.password=o),placeholder:e.$t("password"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),f(N,{class:"btn",type:"primary",onClick:X,loading:C.value},{default:b(()=>[M(i(e.$t("loginBtn")),1)]),_:1},8,["loading"])],512),[[P,m.value==="login"]]),I(r("div",null,[f(g,{class:"email-input",modelValue:l.email,"onUpdate:modelValue":t[4]||(t[4]=o=>l.email=o),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},{append:b(()=>[r("div",{onClick:x(L,["stop"])},[m.value!=="login"?(a(),h(A,{key:0,ref_key:"mySelect",ref:U,modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o),placeholder:e.$t("select"),class:"select"},{default:b(()=>[(a(!0),d(K,null,z(n(_),o=>(a(),h(k,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):V("",!0),r("div",null,[r("span",null,i(p.value),1),f(n(J),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),_:1},8,["modelValue","placeholder"]),f(g,{modelValue:l.password,"onUpdate:modelValue":t[5]||(t[5]=o=>l.password=o),placeholder:e.$t("password"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),f(g,{modelValue:l.confirmPassword,"onUpdate:modelValue":t[6]||(t[6]=o=>l.confirmPassword=o),placeholder:e.$t("confirmPwd"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),n(s).settings.regKey===0?(a(),h(g,{key:0,modelValue:l.code,"onUpdate:modelValue":t[7]||(t[7]=o=>l.code=o),placeholder:e.$t("regKey"),type:"text",autocomplete:"off"},null,8,["modelValue","placeholder"])):V("",!0),n(s).settings.regKey===2?(a(),h(g,{key:1,modelValue:l.code,"onUpdate:modelValue":t[8]||(t[8]=o=>l.code=o),placeholder:e.$t("regKeyOptional"),type:"text",autocomplete:"off"},null,8,["modelValue","placeholder"])):V("",!0),I(r("div",{class:"register-turnstile","data-sitekey":n(s).settings.siteKey,"data-callback":"onTurnstileSuccess","data-error-callback":"onTurnstileError","data-after-interactive-callback":"loadAfter","data-before-interactive-callback":"loadBefore"},[n(T)?(a(),d("span",_e,i(e.$t("verifyModuleFailed")),1)):V("",!0)],8,Ue),[[P,S.value]]),f(N,{class:"btn",type:"primary",onClick:Y,loading:E.value},{default:b(()=>[M(i(e.$t("regBtn")),1)]),_:1},8,["loading"])],512),[[P,m.value!=="login"]]),n(s).settings.register===0?(a(),d(K,{key:2},[m.value==="login"?(a(),d("div",{key:0,class:"switch",onClick:t[9]||(t[9]=o=>m.value="register")},[M(i(e.$t("noAccount"))+" ",1),r("span",null,i(e.$t("regSwitch")),1)])):(a(),d("div",{key:1,class:"switch",onClick:t[10]||(t[10]=o=>m.value="login")},[M(i(e.$t("hasAccount"))+" ",1),r("span",null,i(e.$t("loginSwitch")),1)]))],64)):V("",!0)])])])}}},qe=ye(Te,[["__scopeId","data-v-645032c7"]]);export{qe as default};

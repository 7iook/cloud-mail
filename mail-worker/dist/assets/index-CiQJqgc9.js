import{e as v}from"./index-DzjioUTY.js";import{b as D}from"./email-CA6wn_3x.js";import{s as S,a as _}from"./star-BRkLAY2S.js";import{u as b}from"./email-9j19DGMK.js";import{ab as g,A as y,G as c,J as L,p as j,o as E,q as m,i as I,t as p,g as k,h as i,an as f}from"./index-92mnh-J5.js";import{u as x,d as s}from"./db-DUC9dwwC.js";import"./time-utils-8_bD8pZw.js";import"./index-ChZfA3gH.js";import"./vnode-DfneDD37.js";import"./index-CG9L6tLM.js";import"./throttle-BQKBmdXm.js";import"./iconify-VCTUy_UH.js";import"./el-scrollbar-lgMH0mZQ.js";import"./el-empty-CKfYwwv3.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-tag-Dck20whD.js";import"./el-checkbox-DpAuy9Ti.js";import"./index-UYGPyXpS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./el-skeleton-item-UTnpAQ6A.js";import"./day-DI1_lKIq.js";import"./dayjs.min-BodJrPHb.js";import"./email-highlight-utils-Dx-h0BtP.js";import"./clipboard-utils-Bf-9Um4a.js";import"./el-overlay-jTA8uYnN.js";import"./index-B-u1Rqw0.js";import"./validator-Cw4sOcG_.js";/* empty css                  *//* empty css                       *//* empty css                 */const B={class:"send-email"},lt=Object.assign({name:"draft"},{__name:"index",setup(A){const a=x(),d=g(),o=y({}),n=b();c(()=>a.setDraft,async()=>{const t=f(a.setDraft),e=t.draftId,r=f(a.setDraft.attachments);if(delete t.draftId,delete t.attachments,!t.content&&!t.subject&&!(t.receiveEmail.length>0)){await s.value.draft.delete(e),await s.value.att.delete(e),a.refreshList++;return}await s.value.draft.update(e,t),await s.value.att.update(e,{attachments:r}),a.refreshList++},{deep:!0}),c(()=>a.refreshList,async()=>{const{list:t}=await l();o.value.emailList.length=0,o.value.emailList.push(...t)});function l(){return new Promise((t,e)=>{s.value.draft.orderBy("createTime").reverse().toArray().then(r=>{t({list:r})})})}async function u(t){await s.value.draft.bulkDelete(t),a.refreshList++}async function h(t){const e=await s.value.att.get(t.draftId);t.attachments=e.attachments,d.writerRef.openDraft(t)}function w(t){n.cancelStarEmailId=t.emailId,o.value.deleteEmail([t.emailId])}return L(()=>{n.starScroll=o}),(t,e)=>(E(),j(v,{ref_key:"scroll",ref:o,"allow-star":!1,"cancel-success":w,getEmailList:l,emailDelete:i(D),"star-add":i(_),"star-cancel":i(S),onJump:h,actionLeft:"6px","show-account-icon":!1,"show-first-loading":!1,showStar:!1,onDeleteDraft:u,type:"draft"},{name:m(r=>[k("span",B,p(r.email.receiveEmail.join(",")||"("+t.$t("noRecipient")+")"),1)]),subject:m(r=>[I(p(r.email.subject||"("+t.$t("noSubject")+")"),1)]),_:1},8,["emailDelete","star-add","star-cancel"]))}});export{lt as default};
